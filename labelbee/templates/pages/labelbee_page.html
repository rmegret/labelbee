<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="labelBee video annotation system">
  <meta name="author" content="Rémi Mégret">

  <link rel="icon" type="image/png" href="images/BeeTrackerlogo.png">

  <title>LabelBee</title>

  <script src="js/extern/jquery-ui-1.12.1.custom/external/jquery/jquery.js"></script>
  <script src="js/extern/jquery-ui-1.12.1.custom/jquery-ui.js"></script>
  <link href="js/extern/jquery-ui-1.12.1.custom/jquery-ui.css" rel="stylesheet">

  <link href="css/bootstrap.css" rel="stylesheet">

 <!--  <script type="text/javascript" src="js/extern/jquery.js"></script> -->
  <script type="text/javascript" src="js/extern/bootstrap.js"></script>
  <script type="text/javascript" src="js/extern/VideoFrame.js"></script>
  
  <script type="text/javascript" src="js/extern/fabric/dist/fabric.js"></script>
<!--   <script type="text/javascript" src="js/extern/fabric.canvasex.js"></script> -->
  
  <script type="text/javascript" src="js/extern/D3/d3.js"></script>
  <script type="text/javascript" src="js/extern/marcj-css-element-queries-134443d/src/ResizeSensor.js"></script>
  <script type="text/javascript" src="js/extern/jquery.csv.js"></script>
  
  <script type="text/javascript" src="js/extern/perspective-transform/perspective-transform.js"></script>
  
  <script type="text/javascript" src="js/Model.js"></script>
  <script type="text/javascript" src="js/VideoList.js"></script>
  <script type="text/javascript" src="js/VideoControl.js"></script>
  <script type="text/javascript" src="js/OverlayControl.js"></script>
  <script type="text/javascript" src="js/SelectionControl.js"></script>
  <script type="text/javascript" src="js/AnnotationIO.js"></script>
  <script type="text/javascript" src="js/ChronoAxes.js"></script>
  <script type="text/javascript" src="js/ChronoControl.js"></script>
  <script type="text/javascript" src="js/ZoomView.js"></script>
  <script type="text/javascript" src="js/labelBee.js"></script>
  
  <link href="css/custom.css" rel="stylesheet">
</head>

<body onload="init()">
<!--   <nav class="navbar navbar-inverse navbar-fixed-top"> -->
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">

      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false"
          aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>

        <a class="navbar-brand" href="#"><img style="display:inline-block" src="images/BeeTrackerlogo.png" width="25px" height="25px"> labelBee</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
<!-- 
        <ul class="nav navbar-nav">
          <li class="active"><a href="#">Home</a></li>
          <li><a href="#about">About</a></li>
          <li><a href="#help">Help</a></li>
        </ul>
 -->
        <ul class="nav navbar-nav navbar-right">
            <li title="You need to quit labelbee before loging-in/out"><a><span id="whoami">-</span></a></li>
            <li><a href="{{url_for('home_page')}}"><span class="glyphicon glyphicon-log-out"></span> Quit labelbee</a></li>
        </ul>
      </div>
      <!--/.nav-collapse -->
    </div>
  </nav>

  <div class="container main">
  
  <!-- Modal  -->
    <div class="modal fade" id="mainAlertDialog" role="dialog">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Alert</h4>
          </div>
          <div class="modal-body alert alert-warning" >
                <!-- To be filled up by AJAX request -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  
    <table class="main-table">
      <tr>
        <td>
          <div id="left-side">

          <p>
            <!--Change to div-->
            
            <button value="Play Backwards" onclick="videoControl.playPauseVideoBackward()" id="playbackward" type="button" class="btn btn-info btn-sm"><span class="glyphicon glyphicon-pause"></span><span class="glyphicon glyphicon-play icon-flipped"></span></button>
            <input type="text" size="6" value="1" id="playRate" onchange="videoControl.playRateInputChanged()""></input>
            <button value="Play" onclick="videoControl.playPauseVideo()" id="play"  type="button" class="btn btn-info btn-sm"><span class="glyphicon glyphicon-play"></span><span class="glyphicon glyphicon-pause"></span></button>
            
            <button value="Previous minute" onclick="videoControl.rewind(200)" type="button" class="btn btn-info btn-xs x-small nopad fwbut fwbut3"><span class="glyphicon glyphicon-fast-forward icon-flipped"></span><br class="negmargin"><span>10s</span></button>
            <button value="Previous second" onclick="videoControl.rewind(20)" type="button" class="btn btn-info btn-xs x-small nopad fwbut fbut2"><span class="glyphicon glyphicon-fast-forward icon-flipped"></span><br class="negmargin"><span>1s</span></button>
            <button value="Previous frame" onclick="videoControl.rewind(1)" type="button" class="btn btn-info btn-xs x-small nopad fwbut fwbut1"><span class="glyphicon glyphicon-step-backward"></span><br class="negmargin"><span>1f</span></button>
            
            <button value="Next frame" onclick="videoControl.forward(1)" type="button" class="btn btn-info btn-xs x-small nopad fwbut fwbut1"><span class="glyphicon glyphicon-step-forward"></span><br class="negmargin"><span>1f</span></button>
            <button value="Next second" onclick="videoControl.forward(20)" type="button" class="btn btn-info btn-xs x-small nopad fwbut fwbut2"><span class="glyphicon glyphicon-fast-forward"></span><br class="negmargin"><span>1s</span></button>
            <button value="Next minute" onclick="videoControl.forward(200)" type="button" class="btn btn-info btn-xs x-small nopad fwbut fwbut3"><span class="glyphicon glyphicon-fast-forward"></span><br class="negmargin"><span>10s</span></button>

          </p>
          <p>
          <div id="beeInfo" class="">
            <button id="newRectForCurrentTag" onclick="newRectForCurrentTag()" type="button" class="btn btn-green-toggle btn-xs" title="Create an annotation from current Tag">Annotate</button>
            Change ID <input type="text" size="6" value="" id="I" onkeypress="onKeyDown_IDEdit(event)""></input>
            <input type="button" value="Delete" onclick="deleteSelected()" class="btn btn-warning btn-xs" style="position: inline" id="deleteButton">
            <button type="button" onclick="undoAction()" class="btn btn-info btn-xs" style="position: inline" id="undoButton">Undo</button>

            
            <div id="alerttext"></div>
            
            <br>
   
            <div style="display:inline-block">
            <button onclick="onLabelToggled(event)" type="button" class="btn btn-green-toggle btn-xs labeltoggle fanning" thelabel="fanning" title="Toogle label">Fanning</button>
            <button onclick="onLabelToggled(event)" type="button" class="btn btn-green-toggle btn-xs labeltoggle pollen" thelabel="pollen" title="Toogle label">Pollen</button>
            <button onclick="onLabelToggled(event)" type="button" class="btn btn-green-toggle btn-xs labeltoggle entering" thelabel="entering" title="Toogle label">Entering <span class="glyphicon glyphicon-arrow-up small" style="color:magenta"></span></button>
            <button onclick="onLabelToggled(event)" type="button" class="btn btn-green-toggle btn-xs labeltoggle leaving" thelabel="leaving" title="Toogle label">Leaving <span class="glyphicon glyphicon-arrow-down small" style="color:green"></span></button>
            <button onclick="onLabelToggled(event)" type="button" class="btn btn-green-toggle btn-xs labeltoggle walking" thelabel="walking" title="Toogle label">Walking <span class="glyphicon glyphicon-repeat small"></span></button>
            <button onclick="onLabelToggled(event)" type="button" class="btn btn-green-toggle btn-xs labeltoggle expulsion" thelabel="expulsion" title="Toogle label Expulsion: when a bee is rejected/expelled from the colony">Expulsion</button>
            <button onclick="onLabelToggled(event)" type="button" class="btn btn-green-toggle btn-xs labeltoggle falsealarm" thelabel="falsealarm" title="Toogle FalseAlarm label: when a tag detection is not a tag">FalseAlarm <span class="glyphicon glyphicon-remove small red"></span></button>
            <button onclick="onLabelToggled(event)" type="button" class="btn btn-green-toggle btn-xs labeltoggle wrongid" thelabel="wrongid" title="Toogle WrongID label: when a tag is detected but decoded with an incorrect ID">WrongID <span class="glyphicon glyphicon-remove small blue"></span></button>
            </div>
            
            <br>
            <div class="textbox-inline">
              <label>Labels: </label><input type="textbox" value="" class="resizedTextbox" id="labels">
              <label>Notes: </label><input type="textbox" value="" class="resizedTextbox" id="notes">
<!--                    <label>Note: </label><textarea rows="1" cols="50" id="notes"></textarea>  -->
            </div>
<!--             </div> -->
<!--             <br> -->

            <p id="alerttext"></p>
          </div>
          </p>
          
          <!-- # VIDEO VIEW -->
          
          <div id="canvasresize" class="ui-widget-content">
              <div class="canvaswrapper">
                <video src="" id="video" style="width:400px; z-index: -1"></video>
                <canvas id="canvas" style="z-index: 2"></canvas>
                <canvas id="canvas1" style="border: none; z-index: 3"></canvas>
              </div>
          </div>
          
          <!-- # VIDEO CONTROL -->

          <div class="sortable">
              
              <div class='block inline-collapsible'>
              <div class="block-header small">FocusInterval:</div>
              <span class="block-content">
              <button onclick="shiftTrackWindow(-0.75)" type="button" class="btn btn-window btn-xs" title="Reduce track window"><span class="glyphicon glyphicon-step-backward small"></span></button>
              <button onclick="shiftTrackWindow(0.75)" type="button" class="btn btn-window btn-xs" title="Extend track window"><span class="glyphicon glyphicon-step-forward small"></span></button>
              
              <button value="win-" onclick="scaleTrackWindow(0.5)" type="button" class="btn btn-window btn-xs" title="Reduce track window"><span class="glyphicon glyphicon-chevron-right small"></span>-<span class="glyphicon glyphicon-chevron-left small"></span></button>
              <button value="win+" onclick="scaleTrackWindow(2)" type="button" class="btn btn-window btn-xs" title="Extend track window"><span class="glyphicon glyphicon-chevron-left small"></span>+<span class="glyphicon glyphicon-chevron-right small"></span></button>
              
              <input id="focusTrackWindow" value="FocusView" onclick="onClickFocusTrackWindow()" ondblclick="onDblClickFocusTrackWindow()" type="button" class="btn btn-pink-toggle btn-xs" title="Focus on Track window">
              
              <button value="1s" onclick="setTrackWindow(20)" type="button" class="btn btn-default btn-xs" title="Track window = 1s">1s</button>
              <button value="10s" onclick="setTrackWindow(200)" type="button" class="btn btn-default btn-xs" title="Track window = 10s">10s</button>
              <button value="1m" onclick="setTrackWindow(1200)" type="button" class="btn btn-default btn-xs" title="Track window = 1min">1m</button>
              </span>
              </div>
              
              <div class='block inline-collapsible'>
              <div class="block-header small">ChronogramView:</div>
              <span class="block-content">
              <div onclick="shiftTimeDomain(-0.5)"  class="btn btn-info btn-xs" title="Shift left"><span class="glyphicon glyphicon-step-backward small"></span></div>
              <div onclick="shiftTimeDomain(0.5)"  class="btn btn-info btn-xs" title="Shift right"><span class="glyphicon glyphicon-step-forward small"></span></div>
              
              <input value="Z+" onclick="scaleTimeDomain(2)" type="button" class="btn btn-info btn-xs" title="Zoom In time">
              <input value="Z-" onclick="scaleTimeDomain(1/2)" type="button" class="btn btn-info btn-xs" title="Zoom Out time">
              
              <input value="Video" onclick="onClickFocusVideo()" type="button" class="btn btn-default btn-video-border btn-xs" title="Reinit view">              
              </span>
              </div>
              
              <div class='block inline-collapsible'>
              <div class="block-header small">Selected:</div>
              <span class="block-content">
              <input type="text" value="" size="6" id="selectID" onchange="onSelectIDChanged(event)" class="small btn-green-border">
              
              <button id="prevIDButton" onclick="onClickPrevID()" type="button" class="btn btn-default btn-xs btn-green-border" title="Select Previous Bee">PrevID <span class="glyphicon glyphicon-arrow-up small"></span></button>
              <button id="nextIDButton" onclick="onClickNextID()" type="button" class="btn btn-default btn-xs btn-green-border" title="Select Next Bee">NextID <span class="glyphicon glyphicon-arrow-down small"></span></button>
              
              <button onclick="modifyCurrentObsSpan('extendleft')" type="button" class="btn btn-obs-expand btn-xs" title="Extend annotation left"> <span class="glyphicon glyphicon-chevron-left small"></span>+</button>
              <button onclick="modifyCurrentObsSpan('restrictleft')" type="button" class="btn btn-obs-expand btn-xs" title="Restrict annotation left"> <span class="glyphicon glyphicon-chevron-right small"></span>-</button>
              <span class='small blue-text'>-span-</span>
              <button onclick="modifyCurrentObsSpan('restrictright')" type="button" class="btn btn-obs-expand btn-xs" title="Restrict annotation right">-<span class="glyphicon glyphicon-chevron-left small"></span></button>
              <button onclick="modifyCurrentObsSpan('extendright')" type="button" class="btn btn-obs-expand btn-xs" title="Extend annotation right">+<span class="glyphicon glyphicon-chevron-right small"></span></button>
              </span>
              </div>
              
              <div class='block inline-collapsible'>
              <div class="block-header small">Events:</div>              
              <span class="block-content">
              <button id="autoEventButton" onclick="onAutoEventButtonClick()" type="button" class="btn btn-xs btn-green-toggle" title="Toggle Auto Seek Event Mode">AutoSeek <span class="glyphicon glyphicon-arrow-down small"></span><span class="glyphicon glyphicon-arrow-up small"></span></button>
              <button onclick="eventSeekModeClicked('tag')" type="button" class="btn btn-xs btn-blue-toggle eventSeekMode eventSeekMode-tag" title="Tag mode">Tag</button>
              <button onclick="eventSeekModeClicked('freetag')" type="button" class="btn btn-xs btn-blue-toggle eventSeekMode eventSeekMode-freetag" title="Free tag mode">UnlabeledTag</button>
              <button onclick="eventSeekModeClicked('obs')" type="button" class="btn btn-xs btn-blue-toggle eventSeekMode eventSeekMode-obs" title="Obs mode">Obs</button>
              
              
              <button onclick="gotoFirstEvent()" type="button" class="btn btn-default btn-xs" title="Go to first event"><span class="glyphicon  glyphicon-fast-forward icon-flipped small"></span> First</button>
              <button onclick="gotoPreviousEvent()" type="button" class="btn btn-default btn-xs" title="Go to previous event"><span class="glyphicon glyphicon-step-backward small"></span> Prev</button>
              <button onclick="gotoNextEvent()" type="button" class="btn btn-default btn-xs" title="Go to next event">Next <span class="glyphicon glyphicon-step-forward small"></span></button>
              <button onclick="gotoLastEvent()" type="button" class="btn btn-default btn-xs" title="Go to last event">Last <span class="glyphicon  glyphicon-fast-forward small"></span></button>
              </span>          
              </div>
              
              <div class='block inline-collapsible'>
              <div class="block-header small">Filter:</div>
              <span class="block-content">
              <input type="text" value="0" size="15" id="restrictID" onchange="onRestrictIDChanged(event)" class='btn-restrict-border small'>
              <button id="restrictIDButton" onclick="click_restrictID()" type="button" class="btn btn-restrict-toggle btn-xs" title="Show only tags with this ID">RestrictID</button>
              <button id="restrictIDfromSelectionButton" onclick="restrictIDFromSelection()" type="button" class="btn btn-default btn-restrict-border btn-selection-text btn-xs" title="Restrict to only current Selection ID">R:Selection</button>
              <button id="restrictIDFromWindowButton" onclick="restrictIDFromWindow()" type="button" class="btn btn-default btn-restrict-border btn-window-text btn-xs" title="Restrict to tags in current Window ID">R:Focus</button>
              
              <input type="text" value="" size="15" id="excludeID" onchange="onExcludeIDChanged(event)" class="small btn-orange-border">
              <button id="excludeIDButton" onclick="click_excludeID()" type="button" class="btn btn-orange-toggle btn-xs" title="Exclude these IDs (comma separated list, no spaces)">ExcludeID</button>
              <button id="hideInvalidButton" onclick="click_hideInvalid()" type="button" class="btn btn-orange-toggle btn-xs" title="Hide  markings as falsealarm or wrongid and their tag detection)">Hide FalseAlarms/WrongID</button>
              </span>
              </div>
              
<!-- 
              <div class='block'>
              Misc:
              <button value="ghost" onclick="plotGhostImage()" type="button" class="btn btn-default btn-xs" title="Plot averaged image">Ghost</span></button>
              </div>
 -->
 
               <div class='block inline-collapsible'>
              <span class="block-header small">ChronoSize:</span>
              <span class="block-content">
              <button value="H-" onclick="chronoAdjust('H-')" type="button" class="btn btn-default btn-xs" title="Reduce chronogram height">h-</button>
              <button value="H=" onclick="chronoAdjust('H=')" type="button" class="btn btn-default btn-xs" title="Reinit chronogram height">h=</button>
              <button value="H+" onclick="chronoAdjust('H+')" type="button" class="btn btn-default btn-xs" title="Increase chronogram height">h+</button>
              &nbsp;
              <button value="W-" onclick="chronoAdjust('W-')" type="button" class="btn btn-default btn-xs" title="Reduce chronogram width">w-</button>
              <button value="W=" onclick="chronoAdjust('W=')" type="button" class="btn btn-default btn-xs" title="Reinit chronogram width">w=</button>
              <button value="W+" onclick="chronoAdjust('W+')" type="button" class="btn btn-default btn-xs" title="Increase chronogram width">w+</button>
              <span>
              </div>

              <div id="chronoDiv" class="ui-widget-content" 
                   width="400" height="200" style="padding-right: 16px;">
                  <svg id="svgVisualize" width="100%" height="100%"></svg>
              </div>
          </div>

          </div>

        </td>
        <td>
          <div style="min-width:180px;">

            <div id='right-side' class='sortable'>  
            
            <div id='userpanel' class='collapsible'>
              <label>User/Display</label>
              <div>
                <label for="logout" value="Logout" class="btn btn-primary btn-sm">Log out</label>
                <input type="button" style="display:none" id="logout" onclick="alert('not implemented')">
              
                <label for="fullscreen" value="Fullscreen" class="btn btn-primary btn-sm">Fullscreen</label>
                <input type="button" value="Fullscreen" style="display:none" id="fullscreen" onclick="toggleFullScreen()">
                
                <div class='subpanel collapsible'>
                      <label class="primary">Changelog</label>
                      <div>
                          <ul>
                          <li>2018-01-06: <br>
                              - In "Zoom/Alternate Tags", clicking on a tag will change current annotation to "wrongid" and store the selected tag as correct one. All tags covered by this annotation will appear as virtual tags on the chronogram. 
                          </li>
                          </ul>
                      </div>
                  </div>
                
                <input type="button" value="Refresh user info" onclick="whoami()" class="btn-primary btn-xs">
              </div>
            </div>
            
            <div id='videoinfo' class='collapsible'> 
              <label>Video Info</label>
              <div>
                  <div class='subpanel'>
                      <label class="primary">Current Video</label>
                      <br>
                      <div id="videoName" class="small">-</div>
                      Frame <input type="text" value="-" id="currentFrame" onchange="videoControl.onFrameTextChanged(event)" size="6">
                      <div id="vidTime">Video Time:</div>
                      <div id="realTime">Real Time:</div>
                      <select id="selectboxVideo" name="video" onchange="onSelectboxVideoChanged()" class="">
                          <option value="data/undefined.mp4" selected>Not yet initialized</option>
                      </select> <!-- selectboxVideo -->  
                  </div>
                
                  <div class='subpanel collapsible'>
                    <label class="primary">Video List </label>
                    <div>
                        <div class="float-right"><input onclick="checkVideoList()" type="button" value="Check"  class="btn btn-primary btn-xs"/></div>
                        <table id='videoList'>
                        </table>
                    </div>
                  </div>
                
                  <div class='subpanel collapsible'>
                    <label class="primary">Time/image calibration </label>
                    <div>
                        Start Time:
                        <input type="text" value="2016-07-15T09:59:59.360"  
                               id="startTime" onchange="onStartTimeChanged(event)" size="25">
                          <br>      
                        Real FPS
                        <input type="text" value="???" id="realfps"
                         onchange="onFPSChanged(event)" size="4">&nbsp;Video FPS <input type="text" value="???" id="videofps"
                         onchange="onVideoFPSChanged(event)"  size="4">
                          <br>
                          <input type="text" value="0" id="frameoffset"
                         onchange="onFrameOffsetChanged(event)" size="3">
                         <br>
                        <div id="videoSize">-</div>
                        <div id="canvasSize">-</div>
                    </div>
                  </div>
                
                  <div class='subpanel collapsible'>
                    <label>Meta info </label>
                    <div>
                        Tags family: 
                        <input type="text" value="-" id="videoTagsFamily"
                         size="25" readonly="true">
                        <br>
                        Place: 
                        <input type="text" value="-" id="videoPlace"
                         size="25" readonly="true">
                        <br>
                        Comments: 
                        <textarea id="videoComments"
                         cols="25" rows="3" readonly="true">-</textarea>
                    </div>
                  </div>
                
              <div id='panel_preview' class='collapsible'> 
                  <label>Preview</label>
                  <div>
                      <div class='subpanel'>
                          <label class="primary">Preview Video</label>
                          <br>
                          Name <input type="text" value="-" id="previewVideoName"
                           size="60" onchange="onPreviewVideoInfoChanged()">
                          <div id="previewVideoStatus" class="btn btn-xs" title="Status of Preview Video" style="display:inline-block;">?</div>
                           <br>
                          TimeScale<input type="text" value="-" id="previewVideoTimeScale"
                           size="10" onchange="onPreviewVideoInfoChanged()">
                      </div>
                                
                  </div>
              </div>

            
              </div>
            </div> <!-- videoinfo -->            
            
            <div id='I/O' class='collapsible'> 
              <label>I/O</label>
              <div>
              
              <div class='subpanel collapsible'>
                  <label>Local storage</label>
                  <div>
                      <label for="loadtags" value="Load Tags" class="btn btn-primary btn-sm" tabindex=0>Load Tags</label>
                      <input id="loadtags" type="file" style="display:none" >
                
                      <label for="load" value="Load Events" class="btn btn-primary btn-sm" tabindex=0>Load Events</label>
                      <input id="load" type="file" style="display:none">
                      
                      <input id="erase" onclick="eraseTracks()" type="button" value="Erase Events..." class="btn btn-warning btn-sm" >

                      <br>

                      <input id="save" onclick="saveToFile()" type="button" value="Save Events" class="btn btn-default btn-sm" >
                
                      <input id="saveCSV" onclick="saveToCSV()" type="button" value="Export Events (CSV)" class="btn btn-default btn-sm">
                      
                      <input id="saveBBoxes" onclick="saveToBBoxes()" type="button" value="Export Events (BBox)" class="btn btn-default btn-sm" >
                      
                  </div>
              </div>
              <div class='subpanel collapsible'>
                  <label>Server storage</label>
                  <div>
                    <meta name="csrf-token" content="{{ csrf_token() }}">

                    <input id="jsonFromServer" onclick="jsonFromServer()" type="button" value="Load Events"  class="btn btn-primary btn-sm">
                    
                    <input id="tagsFromServer" onclick="tagsFromServer()"  type="button" value="Load Tags" class="btn btn-primary btn-sm">
                    
                    <input id="videoListFromServer" onclick="videoListFromServer()" type="button" value="Load Video List"  class="btn btn-primary btn-sm">
  
                    <br>
                    
                    <input type="button" onclick="tracksListFromServer()" class="btn btn-green-toggle btn-sm require-server" data-toggle="modal" data-target="#loadTracksFromServerDialog" value="Load Events (JSON)">

                    <input id="jsonToServer" onclick="jsonToServer()" type="button" value="Save Events (JSON)" class="btn btn-green-toggle btn-sm require-server"></button>


              <!-- Modal  -->
                  <div class="modal fade" id="loadTracksFromServerDialog" role="dialog">
                    <div class="modal-dialog modal-lg">
                      <div class="modal-content">
                        <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal">&times;</button>
                          <h4 class="modal-title">Events Files</h4>
                        </div>
                        <div class="modal-body" >
                              <!-- To be filled up by AJAX request -->
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  </div>
              </div>
              
              <div class='subpanel collapsible'>
                  <label>I/O Status</label>
                  <div>
                      <table>
                      <tbody>
                      <tr class="status videolistLoad"></tr>
                      <tr class="status videoLoad"></tr>
                      <tr class="status videoinfoLoad"></tr>
                      <tr class="status videopreviewLoad"></tr>
                      <tr class="status tagsLoad"></tr>
                      </tbody>
                      </table>
                  </div>
              </div>
              
              </div>
            </div>
            
            <!-- ## VIDEO ZOOM -->
            
            <div id='videozoom' class='collapsible'> 
              <label>Zoom</label>
              <div>
              
                <div class="checkbox" style="display:inline">
                    <label><input type="checkbox" checked="false" id="checkboxShowZoom" onclick="zoomOverlay.clickShowZoom()">Update</label>
                    <label><input type="checkbox" checked="true" id="checkboxZoomShowOverlay" onclick="zoomOverlay.clickShowOverlay()">Overlay</label>
                    <label><input type="checkbox" checked="true" id="checkboxZoomToggleGrid" onclick="zoomOverlay.clickToggleGrid()">Grid</label>
<!--                     <label><input type="checkbox" checked="true" id="checkboxZoomShowDistractors" onclick="zoomOverlay.clickShowDistractors()">Alternate Tags</label> -->
                </div>

                <div style="display:inline-block">
                  <input value="Z+" onclick="zoomOverlay.zoomApplyScale(2)" type="button" class="btn btn-info btn-xs" title="Zoom In" style="display=inline;">
                  <input value="Z=" onclick="zoomOverlay.zoomSetScale(1)" type="button" class="btn btn-info btn-xs" title="Reset Zoom" style="display=inline;">
                  <input value="Z-" onclick="zoomOverlay.zoomApplyScale(1/2)" type="button" class="btn btn-info btn-xs" title="Zoom Out" style="display=inline;">
                </div>
                
                <div style="clear:both;"></div>
                
                <table>
                <tr>
                <td>
                <div id="zoomresize" class="ui-widget-content">
                    <div id="zoomDiv" class="canvaswrapper">
                    <canvas id="zoom"></canvas>
                    <canvas id="zoomOverlay" style="border: none; z-index: 3"></canvas>
                    </div>
                </div>
                <div id='zoomInfo'>
                </div>
                </td><td class="top-align">
                <div>
                  <div class='tagdivresizable'>
                    <div class="inline-block tagImageID">ID</div><br>
                    <div id="tagImageDiv" style="width:50px; height:50px;" class="inline-block hidden" >
                    <img id="tagImage" class="pixelated"/>
                    </div>
                    <canvas id="zoomTagCanvas" width="90px" height="90px" class="pixelated tagresizable"></canvas>
                    <canvas id="zoomExtractedTagCanvas" width="90px" height="90px" class="pixelated tagresizable"></canvas>
                    <canvas id="zoomExtractedTagCanvas2" width="90px" height="90px" class="pixelated tagresizable"></canvas>
                  </div>
                </div>
                </td>
                <tr>
                </table>
                
                <div id='videozoom_distractors' class='subpanel collapsible default-active'> 
                  <label>Alternate Tags</label>
                  <div id="zoomDistractors">
                    
                  </div>
                </div>
                
                <div id='videozoom_parts' class='subpanel collapsible default-active'> 
                  <label>Parts labeling</label>
                  <div>
                    <input type="text" size="15" value="" class="resizedTextbox" title="Label for next point/Relabel current point" id="partLabel">
                    <button onclick="zoomOverlay.onButtonClickAddRemovePartLabel(event,'+')" type="button" class="btn btn-success btn-xs" title="Add label to list">+</button>
                    <button onclick="zoomOverlay.onButtonClickAddRemovePartLabel(event,'-')" type="button" class="btn btn-warning btn-xs" title="Remove label from list">-</button>
<!--                     <button onclick="zoomOverlay.onButtonClickAddRemovePartLabel(event,'c')" type="button" class="btn btn-info btn-xs" title="Set label color">c</button> -->
                    <button onclick="zoomOverlay.onButtonClickAddRemovePartLabel(event,'C')" type="button" class="btn btn-info btn-xs" title="Edit label list">...</button>
                    
                    <div id="dialog-form-labelList">
                        <form style="width:100%; height:100%; box-sizing:border-box;">
                        <div style="width:100%; height:100%; box-sizing:border-box;">
                            <label for="labellist-json">JSON label list</label>
                            <textarea name="labellist-json" id="labellist-json" class="text ui-widget-content ui-corner-all" style="width:100%; height:90%; box-sizing:border-box;">test</textarea>
                        </div>
                        </form>
                    </div>

                    <div class="zoomLabel labelButtons">
                        <!-- To be filled up by zoomOverlay.refreshLabelButtons 
                        Example:
                        <button onclick="zoomOverlay.onClickButtonPart(event)" 
                        type="button" class="btn btn-default btn-xs zoomlabel" 
                        data-label="head" title="Select part">head</button>
                     -->
                    </div>
                    
                    <button onclick="zoomOverlay.onToggleButtonAutoLabel(event)" type="button" class="btn btn-green-toggle btn-xs" title="Toggle AutoLabeling">Auto</button>

                    <button onclick="zoomOverlay.onClickButtonDeletePart(event)" type="button" class="btn btn-warning btn-xs" title="Delete part">Delete</button>
                    
                    <button id="buttonShowParts" onclick="zoomOverlay.onToggleButtonShowOnVideo(event)" type="button" class="btn btn-green-toggle btn-xs" title="Show/Hide parts on video canvas">Show on Video</button>
                    <button onclick="onToggleButtonShowOnChrono(event)" type="button" class="buttonShowPartsOnChrono btn btn-green-toggle btn-xs" title="Show/Hide events with parts">Show on Chrono</button>
                  </div>
                </div>
                                
              </div>
            </div>
              
            <div id='beeinfo' class='collapsible'>
              <label>Bee info</label>
              <div>
                <p>Bounding Box:</p>
                <table>
                  <tr>
                    <td><div id="X">X:</div></td>
                    <td><div id="Y">Y:</div></td>
                  </tr>
                  <tr>
                    <td><div id="W">Width:</div></td>
                    <td><div id="H">Height:</div></td>
                  </tr>
                  <tr>
                    <td><div id="CX">Center X:</div></td>
                    <td><div id="CY">Center Y:</div></td>
                  </tr>
                </table>
              </div>
            </div>
            
            <div id='parameters' class='collapsible'>
                <label>Parameters <span class="glyphicon glyphicon-wrench"></span></label>
                <div>
                    <div class="checkbox">
                      <label><input type="checkbox" checked="false" id="mousewheelMode" onclick="onMousewheelModeToggled()" class='btn-sm'>Zoom in Chrono needs shift+mousewheel</label>
                    </div>
                    
                    <div class='subpanel collapsible'>
                      <label>Show/Hide</label>
                      <div>
                          <label>Overlay:</label>
                          <div class="checkbox">
                            <label><input type="checkbox" checked="false" id="showObs" onclick="onShowObsChanged()" class='btn-sm'>Show Events/Obs</label>
                          </div>
                          <div class="checkbox">
                            <label><input type="checkbox" checked="false" id="showObsTracks" onclick="onShowObsChanged()">Show Events/Obs Tracks</label>
                          </div>
                          <div class="checkbox">
                            <label><input type="checkbox" checked="false" class="buttonShowPartsOnChrono" onclick="onToggleButtonShowOnChrono(event)">Highlight events with parts</label>
                          </div>                          
                          <div class="checkbox">
                            <label><input type="checkbox" checked="true" id="showTags" onclick="onShowTagsChanged()">Show Tags</label>
                          </div>
                          <div class="checkbox">
                            <label><input type="checkbox" checked="true" id="showTagsTracks" onclick="onShowTagsTracksChanged()">Show Tags Tracks</label>
                          </div>
                          <div class="checkbox">
                            <label><input type="checkbox" checked="true" id="showSelectedTagsTracks" onclick="onShowTagsTracksChanged()">Show Selected Track</label>
                          </div>
                          <div class="checkbox">
                            <label><input type="checkbox" checked="true" id="showTagsOrientation" onclick="onShowTagsChanged()">Show Tags Orientation</label>
                          </div>
                          <div class="inline-block">
                              Track window
                  
                              <input type="text" value="5" size="6" id="trackWindow" onchange="onTrackWindowChanged(event)">             
                  
                              <select id="selectboxTrackDir" name="selectboxTrackDir" onchange="onTrackDirChanged()" class="" style="display:inline-block;">
                              <option value="Bidirectional" selected>Bidirectional</option>
                              <option value="Forward">Forward</option>
                              <option value="Backward">Backward</option>
                              </select> <!-- selectboxVideo -->  
                          </div>
                          <hr>
                          <label>Chronogram:</label>
                          <div class="checkbox">
                                <label><input type="checkbox" checked="true" id="showObsChrono" onclick="onChronoParametersChanged()"/>Show Obs</label>
                          </div>
                          <div class="checkbox">
                              <label><input type="checkbox" checked="true" id="showTagsChrono" onclick="onChronoParametersChanged()"/>Show Tags</label>
                        </div>

                      </div>
                    </div>
                  
                  
                    <div class='subpanel collapsible'>
                      <label>Tag filtering</label>
                      <div>
                  
                        <div class="inline-block">
                            Hamming:
                            <div class="inline-block">
                            <button value="H0" onclick="chronoFilter('H0')" type="button" class="btn btn-info btn-xs" title="Show only tags with Hamming==0">H0</button>
                            <button value="H1" onclick="chronoFilter('H1')" type="button" class="btn btn-info  btn-xs" title="Show only tags with Hamming<=1">H1</button>
                            <button value="H2" onclick="chronoFilter('H2')" type="button" class="btn btn-info btn-xs" title="Show only tags with Hamming<=2">H2</button>
                            <button value="H&infin;" onclick="chronoFilter('Hall')" type="button" class="btn btn-info btn-xs" title="Show all tags, including virtual ones">all</button>
                            </div>
                        </div>
              
                        <div class="inline-block">
                            &Delta;<input type="text" value="0" size="2" id="tagsIntervalFilterMinLength" onchange="onTagsParametersChanged(event)">
                        </div>
              
                        <div class="requireDM inline-block">
                            DM min<input type="text" value="20" size="2" id="tagsMinDM" onchange="onTagsParametersChanged(event)" class="requireDM">
                        </div>
                        
                        <div class="requireRGB inline-block">
                            RGB:
                            <input type="button" id="tagsUseRgbFilter" onclick="chronoFilter('RGB')" class="btn btn-xs requireRGB btn-orange-toggle active" title="Show only tags with no blue background" value="No blue"/>
                            <input type="button" id="tagsUseRgbFilterContrast" onclick="chronoFilter('RGB_contrast')" class="btn btn-xs requireRGB btn-orange-toggle disabled" title="Show only tags with high contrast" value="High contrast"/>
                        </div>
                        
              
                        <div class="inline-block">
                            ROI:
                  
                            <input type="text" value="0,0,w,h" size="16" id="ROI" onchange="onROITextChanged(event)" title="Region of Interest format left,top,right,bottom in video pixels">
                            <input id='useROI' value="Apply" onclick="onClickROI()" type="button" class="btn btn-orange-toggle btn-xs active" title="Show/Hide ROI">
                            <input value="Reinit" onclick="updateROIFromVideo()" type="button" class="btn btn-default btn-xs" title="Reinit ROI from video">
                        </div>
                        
                        <div class="inline-block">
                            ExcludeRegions:
                            <button onclick="onClickExcludeRectParams()" type="button" class="btn btn-info btn-xs" title="Edit exclude rects">...</button>
                            <input id='useExcludeRects' value="ExcludeRects" onclick="onClickExcludeRects()" type="button" class="btn btn-orange-toggle btn-xs active" title="Show/Hide Tags in Exclusion Region">
                            <button onclick="onClickExcludeRectAdd()" type="button" class="btn btn-success btn-xs" title="Add current Obs to exclude rects">+</button>
                            <button onclick="onClickExcludeRectNext()" type="button" class="btn btn-info btn-xs" title="Highlight next exclude rects">&#x21AA</button>
                            <button id="excludeRectDeleteButton" onclick="onClickExcludeRectDelete()" type="button" class="btn btn-red btn-xs disabled" title="Delete currently highlighted exclude rects">-</button>
                        </div>
                        
                        <div id="dialog-form-excludeRects">
                            <form style="width:100%; height:100%; box-sizing:border-box;">
                            <div style="width:100%; height:100%; box-sizing:border-box;">
                                <label for="excludeRects-json">excludeRects</label>
                                <textarea name="excludeRects-json" id="excludeRects-json" class="text ui-widget-content ui-corner-all" style="width:100%; height:90%; box-sizing:border-box;">test</textarea>
                            </div>
                            </form>
                        </div>
                  
                        <div class="inline-block">
                            Tags sample filter:
                            <input type="text" value="return true" id="tagsSampleFilter" onchange="onTagsParametersChanged(event)">
                        </div>
                        <div class="text">
                            Tags interval filter:
                            <input type="text" value="return true" id="tagsIntervalFilter" onchange="onTagsParametersChanged(event)">
                        </div>
                        <div class="text">
                            Tags ID filter:
                            <input type="text" value="return true" id="tagsIDFilter" onchange="onTagsParametersChanged(event)">
                        </div>
                    
                      </div>
                    </div>
                  
                </div>
            </div>
            
            <div id='quickhelp' class='collapsible'>
                <label>Quick Help <span class="glyphicon glyphicon-question-sign"></span></label>
                <div>

                  <b>Keyboard:</b>
                  <ul>
                  <li><kbd>&lt;</kbd>/<kbd>&gt;</kbd>: move 1 frame backward/forward</li>
                  <li>+<kbd>Shift</kbd>: move 1 s</li>
                  <li>+<kbd>Ctrl</kbd>: move 1 min</li>
                  <li>+<kbd>Shift</kbd>+<kbd>Ctrl</kbd>: move 10 min</li>
                  <br>
                  <li><kbd>Space</kbd> : Play video</li>
                  <li><kbd>Ctrl</kbd>+<kbd>Space</kbd> : Play video x4</li>
                  <li><kbd>Shift</kbd>+<kbd>Space</kbd> : Play video backward</li>
                  <li><kbd>Return</kbd> : validate and save current bee annotation (becomes yellow)</li>
                  <li><kbd>P</kbd> : mark/unmark pollen</li>
                  <li><kbd>&larr;</kbd>, <kbd>&rarr;</kbd>, <kbd>&uarr;</kbd> and <kbd>&darr;</kbd> : move current annotation box</li>
                  </ul>
                  
                  <b>Mouse in the canvas:</b>
                  <ul>
                  <li><kbd>Ctrl</kbd>+<kbd>Drag</kbd> : Create annotation bbox (click for first corner, drag for second corner)</li>
                  <li><kbd>Shift</kbd>+<kbd>Click</kbd> : Create annotation bbox in one click (shift click on center)</li>
                  </ul>

                  <b>Mouse in the chronogram:</b>
                  <ul>
                  <li><kbd>Drag</kbd>: pan left/right</li>
                  <li><kbd>Shift</kbd>+<kbd>Mousewheel</kbd>: zoom in/out</li>
                  <li><kbd>Click</kbd>: change frame, select ID</li>
                  </ul>

                </div>
            </div>
            
            <div id='labelingTab' class='collapsible'>
                <label>Labeling <span class="glyphicon glyphicon-table"></span></label>
                <div>

                    <div id="obsTable">-</div>
                    
                </div>
            </div>
            
          </div> <!-- right-side -->
        </div>
    </td>
  </tr>
  </table>

  <br/>
  <div id="tagDetails">-</div>
  <br/>  <br/>  <br/>
    
  </div>


<script type="text/javascript">
var csrftoken = $('meta[name=csrf-token]').attr('content')

$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken)
        }
    }
})

var http_script_name = '{{ http_script_name }}';
</script>


</body>

</html>